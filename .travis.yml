language: python

dist: bionic

sudo: required

env:
  global:
  - DO_PLOT=0

matrix:
  include:
  - env: PYTHON_VERSION=2.7
    os: linux
    python: "2.7"
  - env: PYTHON_VERSION=3.6
    os: linux
    python: "3.6"
  - env: PYTHON_VERSION=3
    os: osx
    osx_image: xcode10
    language: generic
  - env: PYTHON_VERSION=3
    os: windows
    language: shell

cache:
    - apt
    - pip

before_install:
  # set conda path info
  - if [ "$TRAVIS_OS_NAME" == "windows" ]; then
      MINICONDA_PATH=$HOME/miniconda;
      MINICONDA_SUB_PATH=$MINICONDA_PATH/bin;
      # MINICONDA_PATH=/c/tools/miniconda3/;
      # MINICONDA_PATH_WIN=`cygpath --windows $MINICONDA_PATH`;
      # MINICONDA_SUB_PATH=$MINICONDA_PATH/Scripts;
    fi

install:
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      # update package repository status (-qq is more quiet)
      sudo rm -rf /var/lib/apt/lists/*;
      sudo apt-get update -qq;
      # remove any obsolete libraries
      sudo apt-get autoremove;
      sudo apt-get install -y cmake libboost-dev libgeos++-dev g++ doxygen;
    fi
  - shopt -s expand_aliases
  - if [ "$PYTHON_VERSION" >= 3 && "$TRAVIS_OS_NAME" == "linux" ]; then
      alias sudo='sudo -H ' && alias pip=pip3;
    fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      sudo pip install setuptools cython;
      sudo pip install numpy scipy pint pytest nngt networkx pyneuroml svg.path dxfgrabber PyOpenGL matplotlib;
      sudo pip install --no-binary shapely, shapely;
      sudo pip install sphinx breathe sphinx-bootstrap-theme;
      cd extra && chmod u+x install_linux.sh && ./install_linux.sh;
    fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      cd extra && chmod u+x install_macos.sh && ./install_macos.sh;
    fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then
      wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-x86_64.exe
      start /wait "" Miniconda4-latest-Windows-x86_64.exe /InstallationType=JustMe /RegisterPython=1 /S /D=$HOME/miniconda
      export PATH="$MINICONDA_PATH:$MINICONDA_SUB_PATH:$PATH";
      source $MINICONDA_PATH/etc/profile.d/conda.sh;
      hash -r;
      conda config --set always_yes yes --set changeps1 no;
      conda update -q conda;
      conda install cmake geos boost;
      echo "Python $CONDA_PYTHON running on $TRAVIS_OS_NAME";
      pip install cython;
      pip install pytest shapely pint PyOpenGL svg.path dxfgrabber;
      cd extra && install_windows.cmd;
    fi

script: pytest tests --ignore=tests/todo
