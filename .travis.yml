language: python

dist: bionic

sudo: required

env:
  global:
    - DO_PLOT=0

matrix:
  include:
    - env: PYTHON_VERSION=2.7 PATH=$HOME/.local/bin:$PATH
      os: linux
      python: "2.7"
    - env: PYTHON_VERSION=3.7 PATH=$HOME/.local/bin:$PATH
      os: linux
      python: "3.7"
    - env: PYTHON_VERSION=3
      os: osx
      language: generic
    - env: PYTHON_VERSION=3
      os: windows
      language: shell

addons:
  apt:
    packages:
      - cmake
      - libboost-dev
      - libgeos++-dev
      - g++
      - python-matplotlib
      - python-tk
      - doxygen

before_install:
  # set conda path info
  - if [ "$TRAVIS_OS_NAME" == "windows" ]; then
      MINICONDA_PATH=/c/tools/miniconda3/;
      MINICONDA_PATH_WIN=`cygpath --windows $MINICONDA_PATH`;
      MINICONDA_SUB_PATH=$MINICONDA_PATH/Scripts;
    fi

install:
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo pip install setuptools cython numpy scipy shapely pint pytest nngt networkx pyneuroml svg.path dxfgrabber PyOpenGL sphinx breathe sphinx-bootstrap-theme; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      cd extra && chmod u+x install_linux.sh && ./install_linux.sh;
    fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      cd extra && chmod u+x install_macos.sh && ./install_macos.sh;
    fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then
      export PATH="$MINICONDA_PATH:$MINICONDA_SUB_PATH:$PATH";
      source $MINICONDA_PATH/etc/profile.d/conda.sh;
      hash -r;
      conda config --set always_yes yes --set changeps1 no;
      conda update -q conda;
      conda install cmake geos boost;
      echo "Python $CONDA_PYTHON running on $TRAVIS_OS_NAME";
      pip install cython;
      pip install pytest shapely pint PyOpenGL svg.path dxfgrabber;
      cd extra && install_windows.cmd;
    fi

script: pytest tests --ignore=tests/todo
